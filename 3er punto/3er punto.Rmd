---
title: "3er punto"
output: html_document
date: "2023-10-02"
---


```{r cars}
# install.packages("readxl")
library(readxl)

```

```{r}
datos <- read_excel("Metro.xlsx")
View(datos)
```

```{r}
x <- c(datos$`Tiempo V1` , datos$`Tiempo V2` , datos$`Tiempo V3`)
y <- c(datos$`Velocidad V1` , datos$`Velocidad V2` , datos$`Velocidad V3`)

datos <- data.frame(x=x,y=y)
```

# Analisis descritivo
```{r}
plot(x , y)
```

El gráfico relaciona la proporcionalidad inversa entre la variable tiempo y la variable velocidad de cada uno de los vagones de manera correcta.


# Modelo propuesto:


```{r}
install.packages("minpack.lm")
```
```{r}

library(minpack.lm)

modelo <- function(x, p, c) {
  return(x^p + c)
}

ajuste_inicial <- nlsLM(y ~ modelo(x, p, c), start = list(p =-0.5, c = 4))

# Obtener los valores iniciales estimados
valores_iniciales_estimados <- coef(ajuste_inicial)
print(valores_iniciales_estimados)

# Ajustar el modelo final con los valores iniciales estimados
ajuste_final <- nlsLM(y ~ modelo(x, p, c), start = valores_iniciales_estimados)

```
```{r}
summary(ajuste_final)
```



```{r}
# MODELO AJUSTE DE CURVA y(teta) = X^teta + ei

m1 <- nls(y ~ (x-a)^p + c,  data= datos, start = list(a=0.8,p = -1, c = 9 ),  algorithm = "port")  # añadí  algorithm = "port"

```



```{r}
summary(m1)
```

```{r}
teta <- coefficients(m1)
```


```{r}
plot(x,y)
points(x,(x^(-2.334684) + 12.074184 ),type="b",col="red")

```



```{r}

# Ajustar un modelo spline cúbico a los vagones
spline_model_vagon<- smooth.spline(datos$x, datos$y, df = 6)  # Puedes ajustar df según la suavidad deseada

# Graficar los datos originales y el modelo spline ajustado
plot(datos$x, datos$y, type = "b", col = "blue", xlab = "Tiempo de llegada", ylab = "Velocidad de los vagones")
lines(spline_model_vagon$x, spline_model_vagon$y, col = "red", lwd = 2)
legend("topright", legend = c("Datos Originales", "Spline Ajustado"), col = c("blue", "red"), lty = 1, lwd = 2)

# Evaluar el modelo en nuevos valores de tiempo (por ejemplo, para hacer predicciones)
nuevos_tiempos <- c(31, 32, 33)  # Nuevos valores de tiempo
predicciones <- predict(spline_model_vagon, xout = nuevos_tiempos)
print(predicciones$y)

```

Con un suavizado moderado de los datos (spar= 1.045756 ), y una penalización relativamente pequeña (lambda es igual a 0.001086861), y GCV es igual a 0.003125936, medida de la bondad de ajuste del modelo spline suavizado , lo que sugiere un buen ajuste del modelo a los datos.